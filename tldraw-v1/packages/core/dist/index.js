"use strict";var Sn=Object.create;var pe=Object.defineProperty,wn=Object.defineProperties,Hn=Object.getOwnPropertyDescriptor,Mn=Object.getOwnPropertyDescriptors,In=Object.getOwnPropertyNames,Re=Object.getOwnPropertySymbols,kn=Object.getPrototypeOf,Ve=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var Oe=(r,e,t)=>e in r?pe(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,g=(r,e)=>{for(var t in e||(e={}))Ve.call(e,t)&&Oe(r,t,e[t]);if(Re)for(var t of Re(e))je.call(e,t)&&Oe(r,t,e[t]);return r},M=(r,e)=>wn(r,Mn(e));var N=(r,e)=>{var t={};for(var n in r)Ve.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&Re)for(var n of Re(r))e.indexOf(n)<0&&je.call(r,n)&&(t[n]=r[n]);return t};var Kn=(r,e)=>{for(var t in e)pe(r,t,{get:e[t],enumerable:!0})},et=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of In(e))!Ve.call(r,o)&&o!==t&&pe(r,o,{get:()=>e[o],enumerable:!(n=Hn(e,o))||n.enumerable});return r};var L=(r,e,t)=>(t=r!=null?Sn(kn(r)):{},et(e||!r||!r.__esModule?pe(t,"default",{value:r,enumerable:!0}):t,r)),Dn=r=>et(pe({},"__esModule",{value:!0}),r);var B=(r,e,t)=>(Oe(r,typeof e!="symbol"?e+"":e,t),t);var Ho={};Kn(Ho,{Cursor:()=>Ze,HTMLContainer:()=>wo,Inputs:()=>w,Renderer:()=>So,SVGContainer:()=>Q,SnapPoints:()=>Fe,TLBoundsCorner:()=>fe,TLBoundsEdge:()=>he,TLPerformanceMode:()=>ze,TLShapeUtil:()=>Pe,Utils:()=>C,inputs:()=>Eo});module.exports=Dn(Ho);var z=L(require("react"));var ie=L(require("react"));var Ct=L(require("react"));var Bt=L(require("react"));var Ee=L(require("react")),me=Ee.createContext({});function E(){return Ee.useContext(me)}var Ce=require("@tldraw/vec"),nt=require("@use-gesture/react"),W=L(require("react"));var h=require("@tldraw/vec");var ze=(o=>(o.TransformSelected="transform_selected",o.TranslateSelected="translate_selected",o.TransformAll="transform_all",o.TranslateAll="translate_all",o))(ze||{}),he=(o=>(o.Top="top_edge",o.Right="right_edge",o.Bottom="bottom_edge",o.Left="left_edge",o))(he||{}),fe=(o=>(o.TopLeft="top_left_corner",o.TopRight="top_right_corner",o.BottomRight="bottom_right_corner",o.BottomLeft="bottom_left_corner",o))(fe||{}),Fe=(s=>(s.minX="minX",s.midX="midX",s.maxX="maxX",s.minY="minY",s.midY="midY",s.maxY="maxY",s))(Fe||{});String.prototype.replaceAll||(String.prototype.replaceAll=function(r,e){return Object.prototype.toString.call(r).toLowerCase()==="[object regexp]"?this.replace(r,e):this.replace(new RegExp(r,"g"),e)});var Be=Math.PI*2,D=class{static lerp(e,t,n){return n=D.clamp(n,0,1),e*(1-n)+t*n}static lerpColor(e,t,n=.5){function o(l){let c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(l);return[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)]}function i(l){return"#"+((1<<24)+(l[0]<<16)+(l[1]<<8)+l[2]).toString(16).slice(1)}let s=o(e)||[0,0,0],a=o(t)||[0,0,0],d=s.slice();for(let l=0;l<3;l++)d[l]=Math.round(d[l]+n*(a[l]-s[l]));return i(d)}static modulate(e,t,n,o=!1){let[i,s]=t,[a,d]=n,l=a+(e-i)/(s-i)*(d-a);return o?a<d?Math.max(Math.min(l,d),a):Math.max(Math.min(l,a),d):l}static clamp(e,t,n){return Math.max(t,typeof n!="undefined"?Math.min(e,n):e)}static deepClone(e){if(e===null)return e;if(Array.isArray(e))return[...e];if(typeof e=="object"){let t=g({},e);return Object.keys(t).forEach(n=>t[n]=typeof e[n]=="object"?D.deepClone(e[n]):e[n]),t}return e}static rng(e=""){let t=0,n=0,o=0,i=0;function s(){let a=t^t<<11;return t=n,n=o,o=i,i^=(i>>>19^a^a>>>8)>>>0,i/4294967296}for(let a=0;a<e.length+64;a++)t^=e.charCodeAt(a)|0,s();return s}static pointsToLineSegments(e,t=!1){let n=[];for(let o=1;o<e.length;o++)n.push([e[o-1],e[o]]);return t&&n.push([e[e.length-1],e[0]]),n}static getRectangleSides(e,t,n=0){let o=[e[0]+t[0]/2,e[1]+t[1]/2],i=h.Vec.rotWith(e,o,n),s=h.Vec.rotWith(h.Vec.add(e,[t[0],0]),o,n),a=h.Vec.rotWith(h.Vec.add(e,t),o,n),d=h.Vec.rotWith(h.Vec.add(e,[0,t[1]]),o,n);return[["top",[i,s]],["right",[s,a]],["bottom",[a,d]],["left",[d,i]]]}static circleFromThreePoints(e,t,n){let[o,i]=e,[s,a]=t,[d,l]=n,c=o*(a-l)-i*(s-d)+s*l-d*a,p=(o*o+i*i)*(l-a)+(s*s+a*a)*(i-l)+(d*d+l*l)*(a-i),m=(o*o+i*i)*(s-d)+(s*s+a*a)*(d-o)+(d*d+l*l)*(o-s),u=-p/(2*c),v=-m/(2*c);return[u,v,Math.hypot(u-o,v-i)]}static perimeterOfEllipse(e,t){let n=Math.pow(e-t,2)/Math.pow(e+t,2);return Math.PI*(e+t)*(1+3*n/(10+Math.sqrt(4-3*n)))}static shortAngleDist(e,t){let n=Math.PI*2,o=(t-e)%n;return 2*o%n-o}static longAngleDist(e,t){return Math.PI*2-D.shortAngleDist(e,t)}static lerpAngles(e,t,n){return e+D.shortAngleDist(e,t)*n}static angleDelta(e,t){return D.shortAngleDist(e,t)}static getSweep(e,t,n){return D.angleDelta(h.Vec.angle(e,t),h.Vec.angle(e,n))}static clampRadians(e){return(Math.PI*2+e)%(Math.PI*2)}static snapAngleToSegments(e,t){let n=Math.PI*2/t;return Math.floor((D.clampRadians(e)+n/2)/n)*n}static isAngleBetween(e,t,n){if(n===e||n===t)return!0;let o=(t-e+Be)%Be,i=(n-e+Be)%Be;return o<=Math.PI!=i>o}static degreesToRadians(e){return e*Math.PI/180}static radiansToDegrees(e){return e*180/Math.PI}static getArcLength(e,t,n,o){let i=D.getSweep(e,n,o);return t*(2*Math.PI)*(i/(2*Math.PI))}static getSweepFlag(e,t,n){let o=h.Vec.angle(e,n);return(h.Vec.angle(e,t)-o+3*Math.PI)%(2*Math.PI)-Math.PI>0?0:1}static getLargeArcFlag(e,t,n){let o=h.Vec.angle(n,e),s=(h.Vec.angle(n,t)-o+3*Math.PI)%(2*Math.PI)-Math.PI;return Math.abs(s)>Math.PI/2?0:1}static getArcDashOffset(e,t,n,o,i){let s=D.getSweepFlag(e,n,o),a=D.getArcLength(e,t,n,o);return-(s<0?a:2*Math.PI*e[2]-a)/2+i}static getEllipseDashOffset(e,t){return-(2*Math.PI*e[2])/2+-t}static pointInCircle(e,t,n){return h.Vec.dist(e,t)<=n}static pointInEllipse(e,t,n,o,i=0){i=i||0;let s=Math.cos(i),a=Math.sin(i),d=h.Vec.sub(e,t),l=s*d[0]+a*d[1],c=a*d[0]-s*d[1];return l*l/(n*n)+c*c/(o*o)<=1}static pointInRect(e,t){return!(e[0]<t[0]||e[0]>e[0]+t[0]||e[1]<t[1]||e[1]>e[1]+t[1])}static pointInPolygon(e,t){let n=0;return t.forEach((o,i)=>{let s=t[(i+1)%t.length];o[1]<=e[1]?s[1]>e[1]&&h.Vec.cross(o,s,e)>0&&(n+=1):s[1]<=e[1]&&h.Vec.cross(o,s,e)<0&&(n-=1)}),n!==0}static pointInBounds(e,t){return!(e[0]<t.minX||e[0]>t.maxX||e[1]<t.minY||e[1]>t.maxY)}static pointInPolyline(e,t,n=3){for(let o=1;o<t.length;o++)if(h.Vec.distanceToLineSegment(t[o-1],t[o],e)<n)return!0;return!1}static getBoundsSides(e){return this.getRectangleSides([e.minX,e.minY],[e.width,e.height])}static expandBounds(e,t){return{minX:e.minX-t,minY:e.minY-t,maxX:e.maxX+t,maxY:e.maxY+t,width:e.width+t*2,height:e.height+t*2}}static boundsCollide(e,t){return!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY)}static boundsContain(e,t){return e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX}static boundsContained(e,t){return D.boundsContain(t,e)}static boundsAreEqual(e,t){return!(t.maxX!==e.maxX||t.minX!==e.minX||t.maxY!==e.maxY||t.minY!==e.minY)}static getBoundsFromPoints(e,t=0){let n=1/0,o=1/0,i=-1/0,s=-1/0;if(e.length<2)n=0,o=0,i=1,s=1;else for(let[a,d]of e)n=Math.min(a,n),o=Math.min(d,o),i=Math.max(a,i),s=Math.max(d,s);return t!==0?D.getBoundsFromPoints(e.map(a=>h.Vec.rotWith(a,[(n+i)/2,(o+s)/2],t))):{minX:n,minY:o,maxX:i,maxY:s,width:Math.max(1,i-n),height:Math.max(1,s-o)}}static centerBounds(e,t){let n=this.getBoundsCenter(e),o=t[0]-n[0],i=t[1]-n[1];return this.translateBounds(e,[o,i])}static snapBoundsToGrid(e,t){let n=Math.round(e.minX/t)*t,o=Math.round(e.minY/t)*t,i=Math.round(e.maxX/t)*t,s=Math.round(e.maxY/t)*t;return{minX:n,minY:o,maxX:i,maxY:s,width:Math.max(1,i-n),height:Math.max(1,s-o)}}static translateBounds(e,t){return{minX:e.minX+t[0],minY:e.minY+t[1],maxX:e.maxX+t[0],maxY:e.maxY+t[1],width:e.width,height:e.height}}static rotateBounds(e,t,n){let[o,i]=h.Vec.rotWith([e.minX,e.minY],t,n),[s,a]=h.Vec.rotWith([e.maxX,e.maxY],t,n);return{minX:o,minY:i,maxX:s,maxY:a,width:e.width,height:e.height}}static getRotatedEllipseBounds(e,t,n,o,i=0){let s=Math.cos(i),a=Math.sin(i),d=Math.hypot(n*s,o*a),l=Math.hypot(n*a,o*s);return{minX:e+n-d,minY:t+o-l,maxX:e+n+d,maxY:t+o+l,width:d*2,height:l*2}}static getExpandedBounds(e,t){let n=Math.min(e.minX,t.minX),o=Math.min(e.minY,t.minY),i=Math.max(e.maxX,t.maxX),s=Math.max(e.maxY,t.maxY),a=Math.abs(i-n),d=Math.abs(s-o);return{minX:n,minY:o,maxX:i,maxY:s,width:a,height:d}}static getCommonBounds(e){if(e.length<2)return e[0];let t=e[0];for(let n=1;n<e.length;n++)t=D.getExpandedBounds(t,e[n]);return t}static getRotatedCorners(e,t=0){let n=[e.minX+e.width/2,e.minY+e.height/2];return[[e.minX,e.minY],[e.maxX,e.minY],[e.maxX,e.maxY],[e.minX,e.maxY]].map(o=>h.Vec.rotWith(o,n,t))}static getTransformedBoundingBox(e,t,n,o=0,i=!1){let[s,a]=[e.minX,e.minY],[d,l]=[e.maxX,e.maxY],[c,p]=[e.minX,e.minY],[m,u]=[e.maxX,e.maxY];if(t==="center")return{minX:c+n[0],minY:p+n[1],maxX:m+n[0],maxY:u+n[1],width:m-c,height:u-p,scaleX:1,scaleY:1};let[v,T]=h.Vec.rot(n,-o);switch(t){case"top_edge":case"top_left_corner":case"top_right_corner":{p+=T;break}case"bottom_edge":case"bottom_left_corner":case"bottom_right_corner":{u+=T;break}}switch(t){case"left_edge":case"top_left_corner":case"bottom_left_corner":{c+=v;break}case"right_edge":case"top_right_corner":case"bottom_right_corner":{m+=v;break}}let b=d-s,x=l-a,f=(m-c)/b,y=(u-p)/x,Y=f<0,U=y<0,H=Math.abs(m-c),P=Math.abs(u-p);if(i){let R=b/x,S=R<H/P,K=H*(y<0?1:-1)*(1/R),k=P*(f<0?1:-1)*R;switch(t){case"top_left_corner":{S?p=u+K:c=m+k;break}case"top_right_corner":{S?p=u+K:m=c-k;break}case"bottom_right_corner":{S?u=p-K:m=c-k;break}case"bottom_left_corner":{S?u=p-K:c=m+k;break}case"bottom_edge":case"top_edge":{let $=(c+m)/2,ee=P*R;c=$-ee/2,m=$+ee/2;break}case"left_edge":case"right_edge":{let $=(p+u)/2,ee=H/R;p=$-ee/2,u=$+ee/2;break}}}if(o%(Math.PI*2)!==0){let R=[0,0],S=h.Vec.med([s,a],[d,l]),K=h.Vec.med([c,p],[m,u]);switch(t){case"top_left_corner":{R=h.Vec.sub(h.Vec.rotWith([m,u],K,o),h.Vec.rotWith([d,l],S,o));break}case"top_right_corner":{R=h.Vec.sub(h.Vec.rotWith([c,u],K,o),h.Vec.rotWith([s,l],S,o));break}case"bottom_right_corner":{R=h.Vec.sub(h.Vec.rotWith([c,p],K,o),h.Vec.rotWith([s,a],S,o));break}case"bottom_left_corner":{R=h.Vec.sub(h.Vec.rotWith([m,p],K,o),h.Vec.rotWith([d,a],S,o));break}case"top_edge":{R=h.Vec.sub(h.Vec.rotWith(h.Vec.med([c,u],[m,u]),K,o),h.Vec.rotWith(h.Vec.med([s,l],[d,l]),S,o));break}case"left_edge":{R=h.Vec.sub(h.Vec.rotWith(h.Vec.med([m,p],[m,u]),K,o),h.Vec.rotWith(h.Vec.med([d,a],[d,l]),S,o));break}case"bottom_edge":{R=h.Vec.sub(h.Vec.rotWith(h.Vec.med([c,p],[m,p]),K,o),h.Vec.rotWith(h.Vec.med([s,a],[d,a]),S,o));break}case"right_edge":{R=h.Vec.sub(h.Vec.rotWith(h.Vec.med([c,p],[c,u]),K,o),h.Vec.rotWith(h.Vec.med([s,a],[s,l]),S,o));break}}[c,p]=h.Vec.sub([c,p],R),[m,u]=h.Vec.sub([m,u],R)}return m<c&&([m,c]=[c,m]),u<p&&([u,p]=[p,u]),{minX:c,minY:p,maxX:m,maxY:u,width:m-c,height:u-p,scaleX:(m-c)/(d-s||1)*(Y?-1:1),scaleY:(u-p)/(l-a||1)*(U?-1:1)}}static getTransformAnchor(e,t,n){let o=e;switch(e){case"top_left_corner":{t&&n?o="bottom_right_corner":t?o="top_right_corner":n?o="bottom_left_corner":o="bottom_right_corner";break}case"top_right_corner":{t&&n?o="bottom_left_corner":t?o="top_left_corner":n?o="bottom_right_corner":o="bottom_left_corner";break}case"bottom_right_corner":{t&&n?o="top_left_corner":t?o="bottom_left_corner":n?o="top_right_corner":o="top_left_corner";break}case"bottom_left_corner":{t&&n?o="top_right_corner":t?o="bottom_right_corner":n?o="top_left_corner":o="top_right_corner";break}}return o}static getRelativeTransformedBoundingBox(e,t,n,o,i){let s=(o?t.maxX-n.maxX:n.minX-t.minX)/t.width,a=(i?t.maxY-n.maxY:n.minY-t.minY)/t.height,d=n.width/t.width,l=n.height/t.height,c=e.minX+e.width*s,p=e.minY+e.height*a,m=e.width*d,u=e.height*l;return{minX:c,minY:p,maxX:c+m,maxY:p+u,width:m,height:u}}static getRotatedSize(e,t){let n=h.Vec.div(e,2),o=[[0,0],[e[0],0],e,[0,e[1]]].map(s=>h.Vec.rotWith(s,n,t)),i=D.getBoundsFromPoints(o);return[i.width,i.height]}static getBoundsCenter(e){return[e.minX+e.width/2,e.minY+e.height/2]}static getBoundsWithCenter(e){let t=D.getBoundsCenter(e);return M(g({},e),{midX:t[0],midY:t[1]})}static getCommonTopLeft(e){let t=[1/0,1/0];return e.forEach(n=>{t[0]=Math.min(t[0],n[0]),t[1]=Math.min(t[1],n[1])}),t}static getFromCache(e,t,n){let o=e.get(t);if(o===void 0&&(e.set(t,n()),o=e.get(t),o===void 0))throw Error("Cache did not include item!");return o}static uniqueId(e=""){return e?((Number(e)^Math.random()*16)>>Number(e)/4).toString(16):`${1e7}-${1e3}-${4e3}-${8e3}-${1e11}`.replace(/[018]/g,D.uniqueId)}static rotateArray(e,t){return e.map((n,o)=>e[(o+t)%e.length])}static debounce(e,t=0){let n;return function(...o){clearTimeout(n),n=setTimeout(()=>e.apply(o),t)}}static getSvgPathFromStroke(e,t=!0){let n=e.length;if(n<4)return"";let o=e[0],i=e[1],s=e[2],a=`M${o[0].toFixed(2)},${o[1].toFixed(2)} Q${i[0].toFixed(2)},${i[1].toFixed(2)} ${te(i[0],s[0]).toFixed(2)},${te(i[1],s[1]).toFixed(2)} T`;for(let d=2,l=n-1;d<l;d++)o=e[d],i=e[d+1],a+=`${te(o[0],i[0]).toFixed(2)},${te(o[1],i[1]).toFixed(2)} `;return t&&(a+="Z"),a}static getSvgPathFromStrokePoints(e,t=!1){let n=e.length;if(n<4)return"";let o=e[0].point,i=e[1].point,s=e[2].point,a=`M${o[0].toFixed(2)},${o[1].toFixed(2)} Q${i[0].toFixed(2)},${i[1].toFixed(2)} ${te(i[0],s[0]).toFixed(2)},${te(i[1],s[1]).toFixed(2)} T`;for(let d=2,l=n-1;d<l;d++)o=e[d].point,i=e[d+1].point,a+=`${te(o[0],i[0]).toFixed(2)},${te(o[1],i[1]).toFixed(2)} `;return t&&(a+="Z"),a}static getPerfectDashProps(e,t,n,o=1,i=!0,s=2){let a,d,l;if(n.toLowerCase()==="dashed")a=t*s,l=1,d=i?(a/2).toString():"0";else if(n.toLowerCase()==="dotted")a=t/100,l=100,d="0";else return{strokeDasharray:"none",strokeDashoffset:"none"};let c=Math.floor(e/a/(2*l));c-=c%o,c=Math.max(c,4);let p=Math.max(a,(e-c*a)/(i?c:c-1));return{strokeDasharray:[a,p].join(" "),strokeDashoffset:d}}static isMobileSafari(){if(typeof window=="undefined")return!1;let e=window.navigator.userAgent,t=!!e.match(/iPad/i)||!!e.match(/iPhone/i),n=!!e.match(/WebKit/i);return t&&n&&!e.match(/CriOS/i)}static throttle(e,t){let n,o;return function(...i){return n||(n=!0,setTimeout(()=>n=!1,t),o=e(...i)),o}}static isDarwin(){return/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)}static metaKey(e){return D.isDarwin()?e.metaKey:e.ctrlKey}static lns(e){let t=e.split("");return t.push(...t.splice(0,Math.round(t.length/5))),t.push(...t.splice(0,Math.round(t.length/4))),t.push(...t.splice(0,Math.round(t.length/3))),t.push(...t.splice(0,Math.round(t.length/2))),t.reverse().map(n=>+n?+n<5?5+ +n:+n>5?+n-5:n:n).join("")}},C=D;B(C,"getSnapPoints",(e,t,n)=>{let o=g({},e),i=[0,0],s=[],a={["minX"]:{id:"minX",isSnapped:!1},["midX"]:{id:"midX",isSnapped:!1},["maxX"]:{id:"maxX",isSnapped:!1},["minY"]:{id:"minY",isSnapped:!1},["midY"]:{id:"midY",isSnapped:!1},["maxY"]:{id:"maxY",isSnapped:!1}},d=["midX","minX","maxX"],l=["midY","minY","maxY"],c=t.map(T=>{let b=d.flatMap((f,y)=>d.map((Y,U)=>{let H=o[f]-T[Y],P=Math.abs(H);return{f,t:Y,gap:H,distance:P,isCareful:y===0||y+U===3}})),x=l.flatMap((f,y)=>l.map((Y,U)=>{let H=o[f]-T[Y],P=Math.abs(H);return{f,t:Y,gap:H,distance:P,isCareful:y===0||y+U===3}}));return[T,b,x]}),p=1/0,m=1/0,u=1/0,v=1/0;return c.forEach(([T,b,x])=>{b.forEach(f=>{f.distance<n&&f.distance<u&&(u=f.distance,p=f.gap)}),x.forEach(f=>{f.distance<n&&f.distance<v&&(v=f.distance,m=f.gap)})}),c.forEach(([T,b,x])=>{p!==1/0&&b.forEach(f=>{Math.abs(f.gap-p)<2&&(a[f.f]=M(g({},a[f.f]),{isSnapped:!0,to:T[f.t],B:T,distance:f.distance}))}),m!==1/0&&x.forEach(f=>{Math.abs(f.gap-m)<2&&(a[f.f]=M(g({},a[f.f]),{isSnapped:!0,to:T[f.t],B:T,distance:f.distance}))})}),i[0]=p===1/0?0:p,i[1]=m===1/0?0:m,o.minX-=i[0],o.midX-=i[0],o.maxX-=i[0],o.minY-=i[1],o.midY-=i[1],o.maxY-=i[1],d.forEach(T=>{let b=a[T];if(!b.isSnapped)return;let{id:x,B:f}=b,y=o[x];s.push(x==="minX"?[[y,o.midY],[y,f.minY],[y,f.maxY]]:[[y,o.minY],[y,o.maxY],[y,f.minY],[y,f.maxY]])}),l.forEach(T=>{let b=a[T];if(!b.isSnapped)return;let{id:x,B:f}=b,y=o[x];s.push(x==="midY"?[[o.midX,y],[f.minX,y],[f.maxX,y]]:[[o.minX,y],[o.maxX,y],[f.minX,y],[f.maxX,y]])}),{offset:i,snapLines:s}}),B(C,"deepMerge",(e,t)=>{let n=g({},e),o=Object.entries(t);for(let[i,s]of o)n[i]=s===Object(s)&&!Array.isArray(s)?D.deepMerge(n[i],s):s;return n});function te(r,e){return(r+e)/2}var I=C;function ot(r,e){let t=W.useRef(void 0),n=W.useRef(void 0),o=W.useRef([0,0]),i=W.useRef(0),{inputs:s,bounds:a,callbacks:d}=E();W.useEffect(()=>{let u=v=>v.preventDefault();return document.addEventListener("gesturestart",u),document.addEventListener("gesturechange",u),()=>{document.removeEventListener("gesturestart",u),document.removeEventListener("gesturechange",u)}},[]);let l=W.useCallback(({event:u})=>{var y,Y,U,H;if(u.preventDefault(),s.isPinching||u.timeStamp<=i.current)return;i.current=u.timeStamp;let[v,T,b]=Yn(u);if((u.altKey||u.ctrlKey||u.metaKey)&&u.buttons===0){let R=[...(Y=(y=s.pointer)==null?void 0:y.point)!=null?Y:[a.width/2,a.height/2],b*.618],S=s.pan(R,u);(U=d.onZoom)==null||U.call(d,M(g({},S),{delta:R}),u);return}let x=Ce.Vec.mul(u.shiftKey&&!I.isDarwin()?[T,0]:[v,T],.5);if(Ce.Vec.isEqual(x,[0,0]))return;let f=s.pan(x,u);(H=d.onPan)==null||H.call(d,f,u)},[d,s,a]),c=W.useCallback(({origin:u,event:v})=>{var x;if(v instanceof WheelEvent)return;let T=e.current;if(!T||!(v.target===T||T.contains(v.target)))return;let b=s.pinch(u,u);s.isPinching=!0,(x=d.onPinchStart)==null||x.call(d,b,v),n.current=b.point,t.current=b.origin,o.current=[0,0]},[d,s,a]),p=W.useCallback(({origin:u,offset:v,event:T})=>{var y;if(T instanceof WheelEvent)return;let b=e.current;if(!(T.target===b||(b==null?void 0:b.contains(T.target)))||!t.current)return;let x=s.pinch(u,t.current),f=Ce.Vec.sub(x.delta,o.current);o.current=x.delta,(y=d.onPinch)==null||y.call(d,M(g({},x),{point:x.point,origin:t.current,delta:[...f,v[0]]}),T),n.current=u},[d,s,a]),m=W.useCallback(({origin:u,event:v})=>{var x;let T=e.current;if(!(v.target===T||(T==null?void 0:T.contains(v.target))))return;let b=s.pinch(u,u);s.isPinching=!1,(x=d.onPinchEnd)==null||x.call(d,b,v),n.current=void 0,t.current=void 0,o.current=[0,0]},[]);(0,nt.useGesture)({onWheel:l,onPinchStart:c,onPinch:p,onPinchEnd:m},{target:e,eventOptions:{passive:!1},pinch:{from:[r.current,0],scaleBounds:()=>({from:r.current,max:5,min:.1})}})}var tt=10;function Yn(r){let{deltaY:e,deltaX:t}=r,n=0;if(r.ctrlKey||r.metaKey){let o=Math.sign(r.deltaY),i=Math.abs(r.deltaY),s=e;i>tt&&(s=tt*o),n=s}return[t,e,n]}var rt=require("react");function it(){let{callbacks:r}=E();(0,rt.useEffect)(()=>{function e(){var t;(t=r.onShapeBlur)==null||t.call(r)}return I.isMobileSafari()?(document.addEventListener("focusout",e),()=>document.removeEventListener("focusout",e)):()=>null},[r])}var st=L(require("react"));function at(){let{callbacks:r,inputs:e}=E();return st.useMemo(()=>({onPointerDown:t=>{var o,i,s;if(t.dead||(t.dead=!0,!e.pointerIsValid(t)))return;if(t.currentTarget.setPointerCapture(t.pointerId),t.button===2){(o=r.onRightPointCanvas)==null||o.call(r,e.pointerDown(t,"canvas"),t);return}let n=e.pointerDown(t,"canvas");t.button===0&&((i=r.onPointCanvas)==null||i.call(r,n,t)),(s=r.onPointerDown)==null||s.call(r,n,t)},onPointerMove:t=>{var o,i;if(t.dead||(t.dead=!0,!e.pointerIsValid(t)))return;let n=e.pointerMove(t,"canvas");t.buttons===1&&t.currentTarget.hasPointerCapture(t.pointerId)&&((o=r.onDragCanvas)==null||o.call(r,n,t)),(i=r.onPointerMove)==null||i.call(r,n,t)},onPointerUp:t=>{var i,s,a,d,l;if(t.dead||(t.dead=!0,e.activePointer=void 0,!e.pointerIsValid(t)))return;let n=e.isDoubleClick(),o=e.pointerUp(t,"canvas");if(t.button===2){(i=r.onPointerUp)==null||i.call(r,o,t);return}t.currentTarget.hasPointerCapture(t.pointerId)&&((s=t.currentTarget)==null||s.releasePointerCapture(t.pointerId)),t.button===0&&(n&&!(o.altKey||o.metaKey)&&((a=r.onDoubleClickCanvas)==null||a.call(r,o,t)),(d=r.onReleaseCanvas)==null||d.call(r,o,t)),(l=r.onPointerUp)==null||l.call(r,o,t)},onDrop:r.onDrop,onDragOver:r.onDragOver}),[r,e])}var Se=L(require("react"));function dt(r){let{rPageState:e,rSelectionBounds:t,callbacks:n,inputs:o}=Se.useContext(me);return Se.useMemo(()=>({onPointerDown:i=>{var a,d,l,c,p,m,u;if(i.dead||(i.dead=!0,!o.pointerIsValid(i)))return;if(i.button===2){(a=n.onRightPointShape)==null||a.call(n,o.pointerDown(i,r),i);return}let s=o.pointerDown(i,r);if((d=i.currentTarget)==null||d.setPointerCapture(i.pointerId),t.current&&C.pointInBounds(s.point,t.current)&&!e.current.selectedIds.includes(r)){i.button===0&&((l=n.onPointBounds)==null||l.call(n,o.pointerDown(i,"bounds"),i),(c=n.onPointShape)==null||c.call(n,s,i)),(p=n.onPointerDown)==null||p.call(n,s,i);return}i.button===0&&((m=n.onPointShape)==null||m.call(n,s,i)),(u=n.onPointerDown)==null||u.call(n,s,i)},onPointerUp:i=>{var d,l,c,p;if(i.dead||(i.dead=!0,!o.pointerIsValid(i))||i.button===2)return;o.activePointer=void 0;let s=o.isDoubleClick(),a=o.pointerUp(i,r);i.pointerId&&i.currentTarget.hasPointerCapture(i.pointerId)&&((d=i.currentTarget)==null||d.releasePointerCapture(i.pointerId)),i.button===0&&(s&&!(a.altKey||a.metaKey)&&((l=n.onDoubleClickShape)==null||l.call(n,a,i)),(c=n.onReleaseShape)==null||c.call(n,a,i)),(p=n.onPointerUp)==null||p.call(n,a,i)},onPointerMove:i=>{var a,d;if(i.dead||(i.dead=!0,i.buttons===2||!o.pointerIsValid(i)||o.pointer&&i.pointerId!==o.pointer.pointerId))return;let s=o.pointerMove(i,r);i.buttons===1&&i.currentTarget.hasPointerCapture(i.pointerId)&&((a=n.onDragShape)==null||a.call(n,s,i)),(d=n.onPointerMove)==null||d.call(n,s,i)},onPointerEnter:i=>{var a;if(!o.pointerIsValid(i))return;let s=o.pointerEnter(i,r);(a=n.onHoverShape)==null||a.call(n,s,i)},onPointerLeave:i=>{var a;if(!o.pointerIsValid(i))return;let s=o.pointerEnter(i,r);(a=n.onUnhoverShape)==null||a.call(n,s,i)}}),[o,n,r])}var Te=require("@tldraw/vec"),ge=L(require("react"));function lt(r,e,t,n,o,i=!1,s=!1,a,d){let l={shape:r,asset:r.assetId?o[r.assetId]:void 0,meta:a,isChildOfSelected:s,isGhost:r.isGhost||i,isEditing:n.editingId===r.id,isBinding:d===r.id,isSelected:n.selectedIds.includes(r.id),isHovered:n.hoveredId===r.id||r.children!==void 0&&(n.hoveredId&&r.children.includes(n.hoveredId)||r.children.some(c=>n.selectedIds.includes(c)))};e.push(l),r.children&&(l.children=[],r.children.map(c=>t[c]).filter(c=>t[c.id]).sort((c,p)=>c.childIndex-p.childIndex).forEach(c=>lt(c,l.children,t,n,o,l.isGhost,l.isSelected||l.isChildOfSelected,a)))}function Xn(r,e){return C.boundsContain(e,r)||C.boundsCollide(e,r)}function ct(r,e,t,n){let{callbacks:o,shapeUtils:i,bounds:s}=E(),a=ge.useRef(),d=ge.useRef(-1),l=ge.useRef(new Set),c=ge.useRef(new Set),{selectedIds:p,camera:m}=e,[u,v]=Te.Vec.sub(Te.Vec.div([0,0],m.zoom),m.point),[T,b]=Te.Vec.sub(Te.Vec.div([s.width,s.height],m.zoom),m.point),x={minX:u,minY:v,maxX:T,maxY:b,height:T-u,width:b-v},f=c.current,y=l.current;f.clear(),y.clear(),Object.values(r.shapes).filter(P=>i[P.type].isStateful||p.includes(P.id)||Xn(i[P.type].getBounds(P),x)).forEach(P=>{if(P.parentId===r.id){y.add(P.id),f.add(P);return}let R=r.shapes[P.parentId];if(R===void 0)throw Error(`A shape (${P.id}) has a parent (${P.parentId}) that does not exist!`);y.add(R.id),f.add(R)}),f.size!==d.current&&(a.current&&clearTimeout(a.current),a.current=requestAnimationFrame(()=>{var P;(P=o.onRenderCountChange)==null||P.call(o,Array.from(y.values()))}),d.current=f.size);let U=e.bindingId?r.bindings[e.bindingId].toId:void 0,H=[];return f.forEach(P=>{if(P===void 0)throw Error("Rendered shapes included a missing shape");lt(P,H,r.shapes,e,t,P.isGhost,!1,n,U)}),H.sort((P,R)=>P.shape.childIndex-R.shape.childIndex),H}var Le=L(require("react"));var Ge=new Map;function Un(r,e){return Object.keys(e).reduce((t,n)=>{let o=e[n];return o?t+`${`--${r}-${n}`}: ${o};
`:t},"")}function $n(r,e,t=":root"){Le.useLayoutEffect(()=>{let n=document.createElement("style"),o=Un(r,e);return n.setAttribute("id",`${r}-theme`),n.setAttribute("data-selector",t),n.innerHTML=`
        ${t} {
          ${o}
        }
      `,document.head.appendChild(n),()=>{n&&document.head.contains(n)&&document.head.removeChild(n)}},[r,e,t])}function Nn(r,e){Le.useLayoutEffect(()=>{if(Ge.get(r))return()=>{};let t=document.createElement("style");return t.innerHTML=e,t.setAttribute("id",r),document.head.appendChild(t),Ge.set(r,t),()=>{t&&document.head.contains(t)&&(document.head.removeChild(t),Ge.delete(r))}},[r,e])}var Wn=(r,...e)=>r.reduce((t,n,o)=>t+n+(o<e.length?e[o]:""),""),An={accent:"rgb(255, 0, 0)",brushFill:"rgba(0,0,0,.05)",brushStroke:"rgba(0,0,0,.25)",brushDashStroke:"rgba(0,0,0,.6)",selectStroke:"rgb(66, 133, 244)",selectFill:"rgba(65, 132, 244, 0.05)",binding:"rgba(65, 132, 244, 0.12)",background:"rgb(248, 249, 250)",foreground:"rgb(51, 51, 51)",grid:"rgba(144, 144, 144, 1)"},On=Wn`
  .tl-container {
    --tl-zoom: 1;
    --tl-scale: calc(1 / var(--tl-zoom));
    --tl-padding: calc(64px * max(1, var(--tl-scale)));
    --tl-performance-all: auto;
    --tl-performance-selected: auto;
    position: relative;
    top: 0px;
    left: 0px;
    width: 100%;
    height: 100%;
    max-width: 100%;
    max-height: 100%;
    box-sizing: border-box;
    padding: 0px;
    margin: 0px;
    z-index: 100;
    overflow: hidden;
    touch-action: none;
    overscroll-behavior: none;
    background-color: var(--tl-background);
  }
  .tl-container * {
    box-sizing: border-box;
  }
  .tl-overlay {
    position: absolute;
    width: 100%;
    height: 100%;
    touch-action: none;
    pointer-events: none;
  }
  .tl-grid {
    position: absolute;
    width: 100%;
    height: 100%;
    touch-action: none;
    pointer-events: none;
    user-select: none;
  }
  .tl-snap-line {
    stroke: var(--tl-accent);
    stroke-width: calc(1px * var(--tl-scale));
  }
  .tl-snap-point {
    stroke: var(--tl-accent);
    stroke-width: calc(1px * var(--tl-scale));
  }
  .tl-canvas {
    position: absolute;
    width: 100%;
    height: 100%;
    touch-action: none;
    pointer-events: all;
    overflow: clip;
  }
  .tl-layer {
    position: absolute;
    top: 0px;
    left: 0px;
    height: 0px;
    width: 0px;
    contain: layout style size;
  }
  .tl-absolute {
    position: absolute;
    top: 0px;
    left: 0px;
    transform-origin: center center;
    contain: layout style size;
  }
  .tl-positioned {
    position: absolute;
    top: 0px;
    left: 0px;
    transform-origin: center center;
    pointer-events: none;
    display: flex;
    align-items: center;
    justify-content: center;
    contain: layout style size;
    will-change: var(--tl-performance-all);
  }
  .tl-positioned-svg {
    width: 100%;
    height: 100%;
    overflow: hidden;
    contain: layout style size;
  }
  .tl-positioned-div {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    padding: var(--tl-padding);
    overflow: hidden;
    contain: layout style size;
  }
  .tl-positioned-selected {
    will-change: var(--tl-performance-selected);
  }
  .tl-inner-div {
    position: relative;
    width: 100%;
    height: 100%;
  }
  .tl-stroke-hitarea {
    fill: none;
    stroke: transparent;
    stroke-width: calc(24px * var(--tl-scale));
    pointer-events: stroke;
    stroke-linecap: round;
    stroke-linejoin: round;
  }
  .tl-fill-hitarea {
    fill: transparent;
    stroke: transparent;
    stroke-width: calc(24px * var(--tl-scale));
    pointer-events: all;
    stroke-linecap: round;
    stroke-linejoin: round;
  }
  .tl-counter-scaled {
    transform: scale(var(--tl-scale));
  }
  .tl-dashed {
    stroke-dasharray: calc(2px * var(--tl-scale)), calc(2px * var(--tl-scale));
  }
  .tl-transparent {
    fill: transparent;
    stroke: transparent;
  }
  .tl-cursor-ns {
    cursor: ns-resize;
  }
  .tl-cursor-ew {
    cursor: ew-resize;
  }
  .tl-cursor-nesw {
    cursor: nesw-resize;
  }
  .tl-cursor-nwse {
    cursor: nwse-resize;
  }
  .tl-corner-handle {
    stroke: var(--tl-selectStroke);
    fill: var(--tl-background);
    stroke-width: calc(1.5px * var(--tl-scale));
  }
  .tl-rotate-handle {
    stroke: var(--tl-selectStroke);
    fill: var(--tl-background);
    stroke-width: calc(1.5px * var(--tl-scale));
    cursor: grab;
  }
  .tl-binding {
    fill: var(--tl-selectFill);
    stroke: var(--tl-selectStroke);
    stroke-width: calc(1px * var(--tl-scale));
    pointer-events: none;
  }
  .tl-user {
    left: calc(-15px * var(--tl-scale));
    top: calc(-15px * var(--tl-scale));
    height: calc(35px * var(--tl-scale));
    width: calc(35px * var(--tl-scale));
    transform: scale(var(--tl-scale));
    pointer-events: none;
    will-change: transform;
  }
  .tl-animated {
    transition: transform 200ms linear;
  }
  .tl-indicator {
    fill: transparent;
    stroke-width: calc(1.5px * var(--tl-scale));
    pointer-events: none;
  }
  .tl-user-indicator-bounds {
    border-style: solid;
    border-width: calc(1px * var(--tl-scale));
  }
  .tl-hovered {
    stroke: var(--tl-selectStroke);
  }
  .tl-selected {
    stroke: var(--tl-selectStroke);
  }
  .tl-locked {
    stroke-dasharray: calc(3px * var(--tl-scale)) calc(3px * var(--tl-scale));
  }
  .tl-editing {
    stroke-width: calc(2.5px * min(5, var(--tl-scale)));
  }
  .tl-performance {
    will-change: transform, contents;
  }
  .tl-clone-target {
    pointer-events: all;
  }
  .tl-clone-target:hover .tl-clone-button {
    opacity: 1;
  }
  .tl-clone-button-target {
    cursor: pointer;
    pointer-events: all;
  }
  .tl-clone-button-target:hover .tl-clone-button {
    fill: var(--tl-selectStroke);
  }
  .tl-clone-button {
    opacity: 0;
    r: calc(8px * var(--tl-scale));
    stroke-width: calc(1.5px * var(--tl-scale));
    stroke: var(--tl-selectStroke);
    fill: var(--tl-background);
  }
  .tl-bounds {
    pointer-events: none;
    contain: layout style size;
  }
  .tl-bounds-bg {
    stroke: none;
    fill: var(--tl-selectFill);
    pointer-events: all;
    contain: layout style size;
  }
  .tl-bounds-center {
    fill: transparent;
    stroke: var(--tl-selectStroke);
    stroke-width: calc(1.5px * var(--tl-scale));
  }
  .tl-brush {
    fill: var(--tl-brushFill);
    stroke: var(--tl-brushStroke);
    stroke-width: calc(1px * var(--tl-scale));
    pointer-events: none;
    contain: layout style size;
  }
  .tl-dashed-brush-line {
    fill: none;
    stroke: var(--tl-brushDashStroke);
    stroke-width: calc(1px * var(--tl-scale));
    pointer-events: none;
  }
  .tl-brush.dashed {
    stroke: none;
  }
  .tl-handle {
    pointer-events: all;
    cursor: grab;
  }
  .tl-handle:hover .tl-handle-bg {
    fill: var(--tl-selectFill);
  }
  .tl-handle:hover .tl-handle-bg > * {
    stroke: var(--tl-selectFill);
  }
  .tl-handle:active .tl-handle-bg {
    cursor: grabbing;
    fill: var(--tl-selectFill);
  }
  .tl-handle:active .tl-handle-bg > * {
    stroke: var(--tl-selectFill);
  }
  .tl-handle {
    fill: var(--tl-background);
    stroke: var(--tl-selectStroke);
    stroke-width: 1.5px;
  }
  .tl-handle-bg {
    fill: transparent;
    stroke: none;
    pointer-events: all;
    r: calc(16px / max(1, var(--tl-zoom)));
  }
  .tl-binding-indicator {
    fill: transparent;
    stroke: var(--tl-binding);
  }
  .tl-centered-g {
    transform: translate(var(--tl-padding), var(--tl-padding));
  }
  .tl-current-parent > *[data-shy='true'] {
    opacity: 1;
  }
  .tl-binding {
    fill: none;
    stroke: var(--tl-selectStroke);
    stroke-width: calc(2px * var(--tl-scale));
  }
  .tl-grid-dot {
    fill: var(--tl-grid);
  }
  .tl-erase-line {
    stroke-linejoin: round;
    stroke-linecap: round;
    pointer-events: none;
    fill: var(--tl-grid);
    opacity: 0.32;
  }
`;function ut(r,e){let t=Le.useMemo(()=>g(g({},An),r),[r]);$n("tl",t,e),Nn("tl-canvas",On)}var se=L(require("react"));function F(r){let{callbacks:e,inputs:t}=E(),n=se.useCallback(d=>{var c,p,m,u;if(d.dead||(d.dead=!0,!t.pointerIsValid(d)))return;(c=d.currentTarget)==null||c.setPointerCapture(d.pointerId);let l=t.pointerDown(d,r);if(d.button===2){(p=e.onRightPointBoundsHandle)==null||p.call(e,l,d);return}d.button===0&&((m=e.onPointBoundsHandle)==null||m.call(e,l,d)),(u=e.onPointerDown)==null||u.call(e,l,d)},[t,e,r]),o=se.useCallback(d=>{var p,m,u;if(d.dead||(d.dead=!0,d.button===2||!t.pointerIsValid(d)))return;let l=t.pointerUp(d,r),c=t.isDoubleClick();d.button===0&&(c&&!(l.altKey||l.metaKey)&&((p=e.onDoubleClickBoundsHandle)==null||p.call(e,l,d)),(m=e.onReleaseBoundsHandle)==null||m.call(e,l,d)),(u=e.onPointerUp)==null||u.call(e,l,d)},[t,e,r]),i=se.useCallback(d=>{var c,p;if(d.dead||(d.dead=!0,!t.pointerIsValid(d))||d.buttons===2)return;let l=t.pointerMove(d,r);d.buttons===1&&d.currentTarget.hasPointerCapture(d.pointerId)&&((c=e.onDragBoundsHandle)==null||c.call(e,l,d)),(p=e.onPointerMove)==null||p.call(e,l,d)},[t,e,r]),s=se.useCallback(d=>{var l;!t.pointerIsValid(d)||(l=e.onHoverBoundsHandle)==null||l.call(e,t.pointerEnter(d,r),d)},[t,e,r]),a=se.useCallback(d=>{var l;!t.pointerIsValid(d)||(l=e.onUnhoverBoundsHandle)==null||l.call(e,t.pointerEnter(d,r),d)},[t,e,r]);return{onPointerDown:n,onPointerUp:o,onPointerEnter:s,onPointerMove:i,onPointerLeave:a}}var ye=L(require("react"));function pt(r,e,t){let n=ye.useRef(),o=ye.useRef();ye.useLayoutEffect(()=>{let{zoom:i,point:s}=t.camera,a=i!==n.current,d=s!==o.current;if(n.current=i,o.current=s,a||d){let l=r.current;if(e&&"current"in e){let c=e.current;a&&c&&c.style.setProperty("--tl-zoom",i.toString()),l&&l.style.setProperty("transform",`scale(${i}) translateX(${s[0]}px) translateY(${s[1]}px)`)}}},[t.camera.zoom,t.camera.point])}var ht=L(require("react"));function mt(r,e){return[(r[0]+e.point[0])*e.zoom,(r[1]+e.point[1])*e.zoom]}function _e(r,e){return r[e.type]}function ft(r,e,t){let{rSelectionBounds:n}=E(),{selectedIds:o}=e,i=ht.useRef(),s,a=0,d=!1,l=!1;if(o.length===1){let p=o[0],m=r.shapes[p];if(!m)throw Error(`selectedIds is set to the id of a shape that doesn't exist: ${p}`);a=m.rotation||0,d=m.isLocked||!1;let u=_e(t,m);s=u.hideBounds?void 0:u.getBounds(m)}else if(o.length>1){let p=o.map(m=>r.shapes[m]);a=0,d=p.every(m=>m.isLocked),s=p.reduce((m,u,v)=>v===0?_e(t,u).getRotatedBounds(u):I.getExpandedBounds(m,_e(t,u).getRotatedBounds(u)),{})}if(s){let[p,m]=mt([s.minX,s.minY],e.camera),[u,v]=mt([s.maxX,s.maxY],e.camera);l=!!Object.values(r.bindings).find(T=>o.includes(T.toId)||o.includes(T.fromId)),n.current={minX:p,minY:m,maxX:u,maxY:v,width:u-p,height:v-m}}else n.current=null;let c=i.current;return!c||!s?i.current=s:s&&c.minX===s.minX&&c.minY===s.minY&&c.maxX===s.maxX&&c.maxY===s.maxY&&(s=i.current),{bounds:s,rotation:a,isLocked:d,isLinked:l}}var Tt=L(require("react"));function gt(r){let{inputs:e,callbacks:t}=E();return Tt.useMemo(()=>({onPointerDown:n=>{var i,s,a;if(n.dead||(n.dead=!0,!e.pointerIsValid(n))||n.button===2)return;(i=n.currentTarget)==null||i.setPointerCapture(n.pointerId);let o=e.pointerDown(n,r);n.button===0&&((s=t.onPointHandle)==null||s.call(t,o,n)),(a=t.onPointerDown)==null||a.call(t,o,n)},onPointerUp:n=>{var s,a,d,l;if(n.dead||(n.dead=!0,!e.pointerIsValid(n))||n.button===2)return;let o=e.isDoubleClick(),i=e.pointerUp(n,r);n.currentTarget.hasPointerCapture(n.pointerId)&&((s=n.currentTarget)==null||s.releasePointerCapture(n.pointerId),n.button===0&&(o&&!(i.altKey||i.metaKey)&&((a=t.onDoubleClickHandle)==null||a.call(t,i,n)),(d=t.onReleaseHandle)==null||d.call(t,i,n))),(l=t.onPointerUp)==null||l.call(t,i,n)},onPointerMove:n=>{var i,s;if(n.dead||(n.dead=!0,!e.pointerIsValid(n))||n.buttons===2)return;let o=e.pointerMove(n,r);n.buttons===1&&n.currentTarget.hasPointerCapture(n.pointerId)&&((i=t.onDragHandle)==null||i.call(t,o,n)),(s=t.onPointerMove)==null||s.call(t,o,n)},onPointerEnter:n=>{var i;if(!e.pointerIsValid(n))return;let o=e.pointerEnter(n,r);(i=t.onHoverHandle)==null||i.call(t,o,n)},onPointerLeave:n=>{var i;if(!e.pointerIsValid(n))return;let o=e.pointerEnter(n,r);(i=t.onUnhoverHandle)==null||i.call(t,o,n)}}),[e,t,r])}var Lt=L(require("react"));function yt(r){let{bounds:e}=E();Lt.useEffect(()=>{let t=i=>{i.preventDefault()},n=i=>{let s=i.touches[0].pageX,a=i.touches[0].radiusX||0;(s-a<10||s+a>e.width-10)&&i.preventDefault()},o=r.current;return o?(o.addEventListener("gestureend",t),o.addEventListener("gesturechange",t),o.addEventListener("gesturestart",t),o.addEventListener("touchstart",n),()=>{o&&(o.removeEventListener("gestureend",t),o.removeEventListener("gesturechange",t),o.removeEventListener("gesturestart",t),o.removeEventListener("touchstart",n))}):()=>{}},[r,e.width])}var vt=L(require("react"));function bt(){let{callbacks:r,inputs:e}=E();return vt.useMemo(()=>({onPointerDown:t=>{var o,i,s,a;if(t.dead||(t.dead=!0,!e.pointerIsValid(t)))return;if(t.button===2){(o=r.onRightPointBounds)==null||o.call(r,e.pointerDown(t,"bounds"),t);return}let n=e.pointerDown(t,"bounds");(i=t.currentTarget)==null||i.setPointerCapture(t.pointerId),t.button===0&&((s=r.onPointBounds)==null||s.call(r,n,t)),(a=r.onPointerDown)==null||a.call(r,n,t)},onPointerUp:t=>{var i,s,a,d;if(t.dead||(t.dead=!0,t.button===2)||(e.activePointer=void 0,!e.pointerIsValid(t)))return;let n=e.isDoubleClick(),o=e.pointerUp(t,"bounds");t.currentTarget.hasPointerCapture(t.pointerId)&&((i=t.currentTarget)==null||i.releasePointerCapture(t.pointerId)),t.button===0&&(n&&!(o.altKey||o.metaKey)&&((s=r.onDoubleClickBounds)==null||s.call(r,o,t)),(a=r.onReleaseBounds)==null||a.call(r,o,t)),(d=r.onPointerUp)==null||d.call(r,o,t)},onPointerMove:t=>{var o,i;if(t.dead||(t.dead=!0,!e.pointerIsValid(t)))return;t.buttons===1&&t.currentTarget.hasPointerCapture(t.pointerId)&&((o=r.onDragBounds)==null||o.call(r,e.pointerMove(t,"bounds"),t));let n=e.pointerMove(t,"bounds");(i=r.onPointerMove)==null||i.call(r,n,t)},onPointerEnter:t=>{var n;!e.pointerIsValid(t)||(n=r.onHoverBounds)==null||n.call(r,e.pointerEnter(t,"bounds"),t)},onPointerLeave:t=>{var n;!e.pointerIsValid(t)||(n=r.onUnhoverBounds)==null||n.call(r,e.pointerEnter(t,"bounds"),t)}}),[e,r])}var we=L(require("react"));function He(r,e=0){let t=we.useRef(null);return we.useLayoutEffect(()=>{let n=t.current,o=`
    translate(
      calc(${r.minX}px - var(--tl-padding)),
      calc(${r.minY}px - var(--tl-padding))
    )
    rotate(${e+(r.rotation||0)}rad)`;n.style.setProperty("transform",o),n.style.setProperty("width",`calc(${Math.floor(r.width)}px + (var(--tl-padding) * 2))`),n.style.setProperty("height",`calc(${Math.floor(r.height)}px + (var(--tl-padding) * 2))`)},[r,e]),t}var xt=L(require("react"));function Pt(){let{inputs:r,callbacks:e}=E();xt.useEffect(()=>{let t=o=>{var i;(i=e.onKeyDown)==null||i.call(e,o.key,r.keydown(o),o)},n=o=>{var i;r.keyup(o),(i=e.onKeyUp)==null||i.call(e,o.key,r.keyup(o),o)};return window.addEventListener("keydown",t),window.addEventListener("keyup",n),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",n)}},[r,e])}var Rt=L(require("react"));function Et(r,e){Rt.useLayoutEffect(()=>{if(e&&"current"in e){let t=e==null?void 0:e.current;if(!t)return;switch(r){case"transform_selected":{t.style.setProperty("--tl-performance-all","auto"),t.style.setProperty("--tl-performance-selected","transform, contents");break}case"transform_all":{t.style.setProperty("--tl-performance-all","transform, contents"),t.style.setProperty("--tl-performance-selected","transform, contents");break}case"translate_selected":{t.style.setProperty("--tl-performance-all","auto"),t.style.setProperty("--tl-performance-selected","transform");break}case"translate_all":{t.style.setProperty("--tl-performance-all","transform"),t.style.setProperty("--tl-performance-selected","transform");break}default:t.style.setProperty("--tl-performance-all","auto"),t.style.setProperty("--tl-performance-selected","auto")}}},[r])}var zn=require("react/jsx-runtime");function Vn(a){var d=a,{id:r,bounds:e,rotation:t=0,isGhost:n=!1,isSelected:o=!1,children:i}=d,s=N(d,["id","bounds","rotation","isGhost","isSelected","children"]);let l=He(e,t);return(0,zn.jsx)("div",M(g({id:r,ref:l,className:`tl-positioned${n?" tl-ghost":""}${o?" tl-positioned-selected":""}`,"aria-label":"container","data-testid":"container"},s),{children:i}))}var G=Bt.memo(Vn);var _=require("react/jsx-runtime");function Fn({brush:r,zoom:e,dashed:t}){return(0,_.jsx)(G,{bounds:r,rotation:0,children:(0,_.jsxs)(Q,{children:[(0,_.jsx)("rect",{className:"tl-brush"+(t?" dashed":""),opacity:1,x:0,y:0,width:r.width,height:r.height,"aria-label":"brush"}),t&&(0,_.jsxs)("g",{className:"tl-dashed-brush-line",children:[(0,_.jsx)(Me,{x1:0,y1:0,x2:r.width,y2:0,zoom:e}),(0,_.jsx)(Me,{x1:r.width,y1:0,x2:r.width,y2:r.height,zoom:e}),(0,_.jsx)(Me,{x1:0,y1:r.height,x2:r.width,y2:r.height,zoom:e}),(0,_.jsx)(Me,{x1:0,y1:0,x2:0,y2:r.height,zoom:e})]})]})})}var St=Ct.memo(Fn);function Me({x1:r,y1:e,x2:t,y2:n,zoom:o}){let i=I.getPerfectDashProps(Math.hypot(t-r,n-e),1/o,"dashed",1,!0,3);return(0,_.jsx)("line",{x1:r,y1:e,x2:t,y2:n,strokeWidth:1/o,strokeDasharray:i.strokeDasharray,strokeDashoffset:i.strokeDashoffset})}var wt=L(require("react")),V=require("react/jsx-runtime"),Ze=wt.memo(({color:r})=>(0,V.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 35 35",fill:"none",fillRule:"evenodd",children:[(0,V.jsxs)("g",{fill:"rgba(0,0,0,.2)",transform:"translate(1,1)",children:[(0,V.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,V.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,V.jsxs)("g",{fill:"white",children:[(0,V.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,V.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,V.jsxs)("g",{fill:r,children:[(0,V.jsx)("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),(0,V.jsx)("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]}));var Ht=L(require("perfect-freehand")),Mt=L(require("react"));var _n=require("react/jsx-runtime");function Gn({points:r,zoom:e}){if(r.length===0)return null;let t=I.getSvgPathFromStroke((0,Ht.default)(r,{size:16/e,start:{taper:!0}}));return(0,_n.jsx)("path",{d:t,className:"tl-erase-line"})}var It=Mt.memo(Gn);var ae=require("react/jsx-runtime"),kt=[[-1,.15,64],[.05,.375,16],[.15,1,4],[.7,2.5,1]];function Kt({grid:r,camera:e}){return(0,ae.jsxs)("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[(0,ae.jsx)("defs",{children:kt.map(([t,n,o],i)=>{let s=o*r*e.zoom,a=e.point[0]*e.zoom,d=e.point[1]*e.zoom,l=a>0?a%s:s+a%s,c=d>0?d%s:s+d%s,p=e.zoom<n?I.modulate(e.zoom,[t,n],[0,1]):1;return(0,ae.jsx)("pattern",{id:`grid-${i}`,width:s,height:s,patternUnits:"userSpaceOnUse",children:(0,ae.jsx)("circle",{className:"tl-grid-dot",cx:l,cy:c,r:1,opacity:p})},`grid-pattern-${i}`)})}),kt.map((t,n)=>(0,ae.jsx)("rect",{width:"100%",height:"100%",fill:`url(#grid-${n})`},`grid-rect-${n}`))]})}var Dt=L(require("react")),de=require("react/jsx-runtime");function Zn({camera:{zoom:r,point:e},children:t}){let n=2.5/r;return(0,de.jsxs)("svg",{className:"tl-overlay",children:[(0,de.jsx)("defs",{children:(0,de.jsx)("g",{id:"tl-snap-point",children:(0,de.jsx)("path",{className:"tl-snap-point",d:`M ${-n},${-n} L ${n},${n} M ${-n},${n} L ${n},${-n}`})})}),(0,de.jsx)("g",{transform:`scale(${r}) translate(${e})`,children:t})]})}var Yt=Dt.memo(Zn);var cn=L(require("react"));var _t=L(require("react"));var Ie=L(require("react"));var Xt=require("react/jsx-runtime"),Q=Ie.memo(Ie.forwardRef(function(s,i){var a=s,{id:e,className:t="",children:n}=a,o=N(a,["id","className","children"]);return(0,Xt.jsx)("svg",M(g({ref:i,className:`tl-positioned-svg ${t}`},o),{children:(0,Xt.jsx)("g",{id:e,className:"tl-centered-g",children:n})}))}));var Ut=L(require("react")),Qn=require("react/jsx-runtime");function qn({bounds:r,isLocked:e,isHidden:t}){return(0,Qn.jsx)("rect",{className:["tl-bounds-center",e?"tl-dashed":""].join(" "),x:-1,y:-1,width:r.width+2,height:r.height+2,opacity:t?0:1,pointerEvents:"none","aria-label":"center handle"})}var $t=Ut.memo(qn);var Nt=L(require("react"));var ke=L(require("react"));var le=require("react/jsx-runtime"),Jn={right:0,bottomRight:45,bottom:90,bottomLeft:135,left:180,topLeft:225,top:270,topRight:315};function jn({bounds:r,side:e,targetSize:t,size:n}){let o=t*2,i={left:-o,topLeft:-o,bottomLeft:-o,right:r.width,topRight:r.width,bottomRight:r.width,top:r.width/2-o/2,bottom:r.width/2-o/2}[e],s={left:r.height/2-o/2,right:r.height/2-o/2,top:-o*2,topLeft:-o,topRight:-o,bottom:r.height,bottomLeft:r.height,bottomRight:r.height}[e],{callbacks:a,inputs:d}=E(),l=ke.useCallback(c=>{var m;c.stopPropagation();let p=d.pointerDown(c,e);(m=a.onShapeClone)==null||m.call(a,p,c)},[a.onShapeClone]);return(0,le.jsxs)("g",{className:"tl-clone-target",transform:`translate(${i}, ${s})`,"aria-label":"clone button",children:[(0,le.jsx)("rect",{className:"tl-transparent",width:t*2,height:t*2}),(0,le.jsxs)("g",{className:"tl-clone-button-target",onPointerDown:l,transform:`translate(${t}, ${t}) rotate(${Jn[e]})`,children:[(0,le.jsx)("circle",{className:"tl-transparent ",r:t}),(0,le.jsx)("path",{className:"tl-clone-button",d:`M -${n/2},-${n/2} L ${n/2},0 -${n/2},${n/2} Z`,strokeLinejoin:"round"})]})]})}var J=ke.memo(jn);var A=require("react/jsx-runtime");function eo({targetSize:r,size:e,bounds:t}){return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(J,{targetSize:r,size:e,bounds:t,side:"top"}),(0,A.jsx)(J,{targetSize:r,size:e,bounds:t,side:"right"}),(0,A.jsx)(J,{targetSize:r,size:e,bounds:t,side:"bottom"}),(0,A.jsx)(J,{targetSize:r,size:e,bounds:t,side:"left"}),(0,A.jsx)(J,{targetSize:r,size:e,bounds:t,side:"topLeft"}),(0,A.jsx)(J,{targetSize:r,size:e,bounds:t,side:"topRight"}),(0,A.jsx)(J,{targetSize:r,size:e,bounds:t,side:"bottomLeft"}),(0,A.jsx)(J,{targetSize:r,size:e,bounds:t,side:"bottomRight"})]})}var Wt=Nt.memo(eo);var At=L(require("react"));var Ke=require("react/jsx-runtime"),to={["top_left_corner"]:"tl-cursor-nwse",["top_right_corner"]:"tl-cursor-nesw",["bottom_right_corner"]:"tl-cursor-nwse",["bottom_left_corner"]:"tl-cursor-nesw"};function no({size:r,targetSize:e,isHidden:t,corner:n,bounds:o}){let i=F(n),s=n==="top_left_corner"||n==="top_right_corner",a=n==="top_left_corner"||n==="bottom_left_corner";return(0,Ke.jsxs)("g",{opacity:t?0:1,children:[(0,Ke.jsx)("rect",g({className:"tl-transparent "+(t?"":to[n]),"aria-label":"corner transparent",x:(a?-1:o.width+1)-e,y:(s?-1:o.height+1)-e,width:e*2,height:e*2,pointerEvents:t?"none":"all"},i)),(0,Ke.jsx)("rect",{className:"tl-corner-handle","aria-label":"corner handle",x:(a?-1:o.width+1)-r/2,y:(s?-1:o.height+1)-r/2,width:r,height:r,pointerEvents:"none"})]})}var ve=At.memo(no);var Ot=L(require("react"));var io=require("react/jsx-runtime"),oo={["top_edge"]:"tl-cursor-ns",["right_edge"]:"tl-cursor-ew",["bottom_edge"]:"tl-cursor-ns",["left_edge"]:"tl-cursor-ew"};function ro({size:r,isHidden:e,bounds:t,edge:n}){let o=F(n),i=n==="top_edge"||n==="bottom_edge",s=n==="right_edge"||n==="bottom_edge",{height:a,width:d}=t;return(0,io.jsx)("rect",g({pointerEvents:e?"none":"all",className:"tl-transparent tl-edge-handle "+(e?"":oo[n]),"aria-label":`${n} handle`,opacity:e?0:1,x:i?r/2:(s?d+1:-1)-r/2,y:i?(s?a+1:-1)-r/2:r/2,width:i?Math.max(0,d+1-r):r,height:i?r:Math.max(0,a+1-r)},o))}var be=Ot.memo(ro);var Vt=L(require("react"));var Z=require("react/jsx-runtime");function so({size:r,bounds:e,isHidden:t}){let n=F("left"),o=F("center"),i=F("right");return(0,Z.jsxs)("g",{cursor:"grab",transform:`translate(${e.width/2-r*4}, ${e.height+r*2})`,"aria-label":"link handle",children:[(0,Z.jsxs)("g",{className:"tl-transparent",pointerEvents:t?"none":"all",children:[(0,Z.jsx)("rect",g({x:0,y:0,width:r*2,height:r*2},n)),(0,Z.jsx)("rect",g({x:r*3,y:0,width:r*2,height:r*2},o)),(0,Z.jsx)("rect",g({x:r*6,y:0,width:r*2,height:r*2},i))]}),(0,Z.jsxs)("g",{className:"tl-rotate-handle",transform:`translate(${r/2}, ${r/2})`,"aria-label":"link rotate handle",children:[(0,Z.jsx)("path",{d:`M 0,${r/2} L ${r},${r} ${r},0 Z`,pointerEvents:"none",opacity:t?0:1}),(0,Z.jsx)("path",{transform:`translate(${r*3}, 0)`,d:`M 0,0 L ${r},0 ${r/2},${r} Z`,pointerEvents:"none",opacity:t?0:1}),(0,Z.jsx)("path",{transform:`translate(${r*6}, 0)`,d:`M ${r},${r/2} L 0,0 0,${r} Z`,pointerEvents:"none",opacity:t?0:1})]})]})}var zt=Vt.memo(so);var Ft=L(require("react"));var De=require("react/jsx-runtime");function ao({bounds:r,targetSize:e,size:t,isHidden:n}){let o=F("rotate");return(0,De.jsxs)("g",{cursor:"grab",opacity:n?0:1,children:[(0,De.jsx)("circle",g({className:"tl-transparent","aria-label":"rotate handle transparent",cx:r.width/2,cy:t*-2,r:e,pointerEvents:n?"none":"all"},o)),(0,De.jsx)("circle",{className:"tl-rotate-handle","aria-label":"rotate handle",cx:r.width/2,cy:t*-2,r:t/2,pointerEvents:"none"})]})}var Gt=Ft.memo(ao);var X=require("react/jsx-runtime"),lo=function({zoom:e,bounds:t,viewportWidth:n,rotation:o,isHidden:i,isLocked:s,hideCloneHandles:a,hideResizeHandles:d,hideRotateHandle:l,hideBindingHandles:c}){let p=(n<768?16:8)/e,m=8/e,u=Math.min(t.width,t.height)*e,v=!l&&!i&&!s&&u>32,T=!i&&!s&&u>24,b=!i&&!s&&u>20,x=!a&&u>24;return(0,X.jsx)(G,{bounds:t,rotation:o,children:(0,X.jsxs)(Q,{children:[(0,X.jsx)($t,{bounds:t,isLocked:s,isHidden:i}),!d&&!s?(0,X.jsxs)(X.Fragment,{children:[(0,X.jsx)(be,{targetSize:p,size:m,bounds:t,edge:"top_edge",isHidden:!T}),(0,X.jsx)(be,{targetSize:p,size:m,bounds:t,edge:"right_edge",isHidden:!T}),(0,X.jsx)(be,{targetSize:p,size:m,bounds:t,edge:"bottom_edge",isHidden:!T}),(0,X.jsx)(be,{targetSize:p,size:m,bounds:t,edge:"left_edge",isHidden:!T}),(0,X.jsx)(ve,{targetSize:p,size:m,bounds:t,isHidden:i||!b,corner:"top_left_corner"}),(0,X.jsx)(ve,{targetSize:p,size:m,bounds:t,isHidden:i||!b,corner:"top_right_corner"}),(0,X.jsx)(ve,{targetSize:p,size:m,bounds:t,isHidden:i||!b,corner:"bottom_right_corner"}),(0,X.jsx)(ve,{targetSize:p,size:m,bounds:t,isHidden:i||!b,corner:"bottom_left_corner"})]}):null,v&&(0,X.jsx)(Gt,{targetSize:p,size:m,bounds:t,isHidden:!T}),x&&(0,X.jsx)(Wt,{bounds:t,targetSize:p,size:m}),!c&&(0,X.jsx)(zt,{targetSize:p,size:m,bounds:t,isHidden:!T})]})})},Zt=_t.memo(lo);var qt=L(require("react"));var qe=require("react/jsx-runtime");function co({bounds:r,rotation:e,isHidden:t}){let n=bt();return(0,qe.jsx)(G,{bounds:r,rotation:e,children:(0,qe.jsx)(Q,{children:(0,qe.jsx)("rect",g({className:"tl-bounds-bg","aria-label":"bounds bg",width:r.width,height:r.height,opacity:t?0:1},n))})})}var Qt=qt.memo(co);var Ye=require("@tldraw/vec"),en=L(require("react"));var Jt=L(require("react"));var ce=require("react/jsx-runtime");function uo({id:r,point:e}){let t=gt(r);return(0,ce.jsx)(G,{bounds:I.translateBounds({minX:0,minY:0,maxX:0,maxY:0,width:0,height:0},e),children:(0,ce.jsx)(Q,{children:(0,ce.jsxs)("g",M(g({className:"tl-handle","aria-label":"handle"},t),{children:[(0,ce.jsx)("circle",{className:"tl-handle-bg",pointerEvents:"all"}),(0,ce.jsx)("circle",{className:"tl-counter-scaled tl-handle",pointerEvents:"none",r:4})]}))})})}var jt=Jt.memo(uo);var Xe=require("react/jsx-runtime");function po({shape:r,zoom:e}){if(r.handles===void 0)return null;let t=null,n=Object.values(r.handles).reduce((o,i)=>{let s=Ye.Vec.add(i.point,r.point);return(!t||Ye.Vec.dist(s,t)*e>=32)&&(o.push(i),t=s),o},[]);return n.length===1?null:(0,Xe.jsx)(Xe.Fragment,{children:n.map(o=>(0,Xe.jsx)(jt,{id:o.id,point:Ye.Vec.add(o.point,r.point)},r.id+"_"+o.id))})}var tn=en.memo(po);var dn=L(require("react"));var sn=L(require("react"));var nn=L(require("react"));var ho=require("react/jsx-runtime");function mo(r){let e=r.utils.getRef(r.shape);return(0,ho.jsx)(r.utils.Component,g({ref:e},r))}var on=nn.memo(mo,(r,e)=>r.isHovered!==e.isHovered||r.isSelected!==e.isSelected||r.isEditing!==e.isEditing||r.isBinding!==e.isBinding||r.isGhost!==e.isGhost||r.meta!==e.meta?!1:e.shape!==r.shape?!e.utils.shouldRender(e.shape,r.shape):!0);var rn=require("react/jsx-runtime");function fo(o){var i=o,{shape:r,utils:e,meta:t}=i,n=N(i,["shape","utils","meta"]);let{callbacks:s}=E(),a=e.getBounds(r),d=dt(r.id);return(0,rn.jsx)(G,{id:r.id,bounds:a,rotation:r.rotation,"data-shape":r.type,isGhost:n.isGhost,isSelected:n.isSelected,children:(0,rn.jsx)(on,g({shape:r,utils:e,meta:t,events:d,bounds:a,onShapeChange:s.onShapeChange,onShapeBlur:s.onShapeBlur},n))})}var an=sn.memo(fo);var ue=require("react/jsx-runtime");function To(i){var s=i,{shape:r,utils:e,meta:t,children:n}=s,o=N(s,["shape","utils","meta","children"]);return(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(an,g({shape:r,utils:e[r.type],meta:t},o)),n&&n.map(a=>(0,ue.jsx)(Qe,g({utils:e},a),a.shape.id))]})}var Qe=dn.memo(To);var ln=L(require("react"));var Ue=require("react/jsx-runtime");function go({isHovered:r=!1,isSelected:e=!1,isEditing:t=!1,shape:n,user:o,meta:i}){let{shapeUtils:s}=E(),a=s[n.type],d=a.getBounds(n),l=He(d,n.rotation);return(0,Ue.jsx)("div",{ref:l,draggable:!1,className:["tl-indicator","tl-absolute",e&&!o?"tl-selected":"tl-hovered",t?"tl-editing":"",n.isLocked?"tl-locked":""].join(" "),children:(0,Ue.jsx)("svg",{width:"100%",height:"100%",children:(0,Ue.jsx)("g",{className:"tl-centered-g",stroke:o==null?void 0:o.color,children:(0,Ue.jsx)(a.Indicator,{shape:n,meta:i,user:o,bounds:d,isSelected:e,isHovered:r})})})})}var xe=ln.memo(go);var q=require("react/jsx-runtime");function Lo({page:r,pageState:e,assets:t,hideBounds:n,hideHandles:o,hideIndicators:i,hideBindingHandles:s,hideCloneHandles:a,hideRotateHandle:d,hideResizeHandles:l,meta:c}){let{bounds:p,shapeUtils:m}=E(),u=ct(r,e,t,c),{bounds:v,isLinked:T,isLocked:b,rotation:x}=ft(r,e,m),{selectedIds:f,hoveredId:y,editingId:Y,camera:{zoom:U}}=e,H=i,P=!0,R=!1,S,K=f.map(k=>r.shapes[k]);if(K.length===1){let k=K[0];R=Y===k.id,R&&(H=!0);let $=m[k.type];P=a||!$.showCloneHandles,k.handles!==void 0&&!R&&(S=k)}return(0,q.jsxs)(q.Fragment,{children:[v&&(0,q.jsx)(Qt,{bounds:v,rotation:x,isHidden:n}),u.map(k=>(0,q.jsx)(Qe,g({utils:m},k),k.shape.id)),!H&&K.map(k=>(0,q.jsx)(xe,{shape:k,meta:c,isSelected:!0,isEditing:R},"selected_"+k.id)),!H&&y&&y!==Y&&(0,q.jsx)(xe,{shape:r.shapes[y],meta:c,isHovered:!0},"hovered_"+y),v&&(0,q.jsx)(Zt,{zoom:U,bounds:v,viewportWidth:p.width,isLocked:b,rotation:x,isHidden:n,hideRotateHandle:d,hideResizeHandles:l,hideBindingHandles:s||!T,hideCloneHandles:P}),!o&&S&&(0,q.jsx)(tn,{shape:S,zoom:U})]})}var un=cn.memo(Lo);var Je=L(require("react"));var j=require("react/jsx-runtime");function yo({snapLines:r}){return(0,j.jsx)(j.Fragment,{children:r.map((e,t)=>(0,j.jsx)(bo,{snapLine:e},t))})}function vo({snapLine:r}){let e=I.getBoundsFromPoints(r);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("line",{className:"tl-snap-line",x1:e.minX,y1:e.minY,x2:e.maxX,y2:e.maxY}),r.map(([t,n],o)=>(0,j.jsx)("use",{href:"#tl-snap-point",x:t,y:n},o))]})}var bo=Je.memo(vo),pn=Je.memo(yo);var $e=L(require("react")),mn=require("react/jsx-runtime");function hn({user:r,Cursor:e}){let t=$e.useRef(null);return $e.useLayoutEffect(()=>{t.current&&(t.current.style.transform=`translate(${r.point[0]}px, ${r.point[1]}px)`)},[r.point]),(0,mn.jsx)("div",{ref:t,className:`tl-absolute tl-user tl-counter-scaled ${r.session?"":"tl-animated"}`,children:(0,mn.jsx)(e,{id:r.id,color:r.color,metadata:r.metadata})})}var Ne=require("react/jsx-runtime");function fn({userId:r,users:e,Cursor:t}){return(0,Ne.jsx)(Ne.Fragment,{children:Object.values(e).filter(n=>n&&n.id!==r).map(n=>(0,Ne.jsx)(hn,{user:n,Cursor:t},n.id))})}var Tn=L(require("react"));var re=require("react/jsx-runtime");function gn({userId:r,users:e,meta:t,page:n}){let{shapeUtils:o}=E();return(0,re.jsx)(re.Fragment,{children:Object.values(e).filter(Boolean).filter(i=>i.id!==r&&i.selectedIds.length>0).map(i=>{let s=i.selectedIds.map(d=>n.shapes[d]).filter(Boolean);if(s.length===0)return null;let a=I.getCommonBounds(s.map(d=>o[d.type].getBounds(d)));return(0,re.jsxs)(Tn.Fragment,{children:[(0,re.jsx)("div",{className:"tl-absolute tl-user-indicator-bounds",style:{backgroundColor:i.color+"0d",borderColor:i.color+"78",transform:`translate(${a.minX}px, ${a.minY}px)`,width:a.width,height:a.height,pointerEvents:"none"}}),s.map(d=>(0,re.jsx)(xe,{shape:d,user:i,meta:t,isHovered:!0},`${i.id}_${d.id}_indicator`))]},i.id+"_shapes")})})}var ne=L(require("react"));var xo=r=>{let e=r.parentElement;for(;e;){if(e===document.body)return document;let{overflowY:t}=window.getComputedStyle(e);if(e.scrollHeight>e.clientHeight&&(t==="auto"||t==="scroll"||t==="overlay"))return e;e=e.parentElement}return document};function Ln(r,e){let{inputs:t,callbacks:n}=E(),o=ne.useRef(!1),i=ne.useCallback(()=>{var s,a;if(o.current){let d=(s=r.current)==null?void 0:s.getBoundingClientRect();if(d){let l={minX:d.left,maxX:d.left+d.width,minY:d.top,maxY:d.top+d.height,width:d.width,height:d.height};t.bounds=l,e(l),(a=n.onBoundsChange)==null||a.call(n,l)}}else o.current=!0},[r,t,n.onBoundsChange]);ne.useEffect(()=>{let s=r.current?xo(r.current):document,a=C.debounce(i,100);return s.addEventListener("scroll",a),window.addEventListener("resize",a),()=>{s.removeEventListener("scroll",a),window.removeEventListener("resize",a)}},[]),ne.useEffect(()=>{let s=new ResizeObserver(a=>{t.isPinching||a[0].contentRect&&i()});return r.current&&s.observe(r.current),()=>{s.disconnect()}},[r,t]),ne.useEffect(()=>{i()},[r])}var O=require("react/jsx-runtime");function Po({id:r,page:e,pageState:t,assets:n,snapLines:o,eraseLine:i,grid:s,users:a,userId:d,components:l={},meta:c,performanceMode:p,showDashedBrush:m,hideHandles:u,hideBounds:v,hideIndicators:T,hideBindingHandles:b,hideCloneHandles:x,hideResizeHandles:f,hideRotateHandle:y,hideGrid:Y,onBoundsChange:U,hideCursors:H}){var $;let P=ie.useRef(null),R=ie.useRef(t.camera.zoom);R.current=t.camera.zoom,ot(R,P),Ln(P,U),it(),yt(P);let S=ie.useRef(null),K=ie.useRef(null);pt(K,S,t),Et(p,S),Pt();let k=at();return(0,O.jsx)("div",{id:r,className:"tl-container",ref:S,children:(0,O.jsxs)("div",M(g({id:"canvas",className:"tl-absolute tl-canvas",ref:P},k),{children:[!Y&&s&&(0,O.jsx)(Kt,{grid:s,camera:t.camera}),(0,O.jsxs)("div",{ref:K,className:"tl-absolute tl-layer","data-testid":"layer",children:[(0,O.jsx)(un,{page:e,pageState:t,assets:n,hideBounds:v,hideIndicators:T,hideHandles:u,hideBindingHandles:b,hideCloneHandles:x,hideResizeHandles:f,hideRotateHandle:y,meta:c}),a&&d&&(0,O.jsx)(gn,{userId:d,users:a,page:e,meta:c}),t.brush&&(0,O.jsx)(St,{brush:t.brush,dashed:m,zoom:t.camera.zoom}),a&&!H&&(0,O.jsx)(fn,{userId:d,users:a,Cursor:($=l==null?void 0:l.Cursor)!=null?$:Ze})]}),(0,O.jsxs)(Yt,{camera:t.camera,children:[i&&(0,O.jsx)(It,{points:i,zoom:t.camera.zoom}),o&&(0,O.jsx)(pn,{snapLines:o})]})]}))})}var yn=ie.memo(Po);var oe=require("@tldraw/vec");var Ro=250,w=class{constructor(){B(this,"pointer");B(this,"keyboard");B(this,"keys",{});B(this,"isPinching",!1);B(this,"bounds",{minX:0,maxX:640,minY:0,maxY:480,width:640,height:480});B(this,"pointerUpTime",0);B(this,"activePointer");B(this,"panStart",e=>{var a,d;let{shiftKey:t,ctrlKey:n,metaKey:o,altKey:i}=e,s={target:"wheel",pointerId:((a=this.pointer)==null?void 0:a.pointerId)||0,origin:((d=this.pointer)==null?void 0:d.origin)||[0,0],delta:[0,0],pressure:.5,point:w.getPoint(e,this.bounds),shiftKey:t,ctrlKey:n,metaKey:o,altKey:i,spaceKey:this.keys[" "]};return this.pointer=s,s});B(this,"pan",(e,t)=>{if(!this.pointer||this.pointer.target!=="wheel")return this.panStart(t);let{shiftKey:n,ctrlKey:o,metaKey:i,altKey:s}=t,a=this.pointer,d=w.getPoint(t,this.bounds),l=M(g({},a),{target:"wheel",delta:e,point:d,shiftKey:n,ctrlKey:o,metaKey:i,altKey:s,spaceKey:this.keys[" "]});return this.pointer=l,l});B(this,"keydown",e=>{var s,a;let{shiftKey:t,ctrlKey:n,metaKey:o,altKey:i}=e;return this.keys[e.key]=!0,{point:((s=this.pointer)==null?void 0:s.point)||[0,0],origin:((a=this.pointer)==null?void 0:a.origin)||[0,0],key:e.key,keys:Object.keys(this.keys),shiftKey:t,ctrlKey:n,metaKey:C.isDarwin()?o:n,altKey:i}});B(this,"keyup",e=>{var s,a;let{shiftKey:t,ctrlKey:n,metaKey:o,altKey:i}=e;return delete this.keys[e.key],{point:((s=this.pointer)==null?void 0:s.point)||[0,0],origin:((a=this.pointer)==null?void 0:a.origin)||[0,0],key:e.key,keys:Object.keys(this.keys),shiftKey:t,ctrlKey:n,metaKey:C.isDarwin()?o:n,altKey:i}})}pointerIsValid(e){if("pointerId"in e&&this.activePointer&&this.activePointer!==e.pointerId)return!1;if("touches"in e){let t=e.changedTouches[0];if(this.activePointer&&this.activePointer!==t.identifier)return!1}return!0}touchStart(e,t){let{shiftKey:n,ctrlKey:o,metaKey:i,altKey:s}=e,a=e.changedTouches[0];this.activePointer=a.identifier;let d={target:t,pointerId:a.identifier,origin:w.getPoint(a,this.bounds),delta:[0,0],point:w.getPoint(a,this.bounds),pressure:w.getPressure(a),shiftKey:n,ctrlKey:o,metaKey:C.isDarwin()?i:o,altKey:s,spaceKey:this.keys[" "]};return this.pointer=d,d}touchEnd(e,t){let{shiftKey:n,ctrlKey:o,metaKey:i,altKey:s}=e,a=e.changedTouches[0],d={target:t,pointerId:a.identifier,origin:w.getPoint(a,this.bounds),delta:[0,0],point:w.getPoint(a,this.bounds),pressure:w.getPressure(a),shiftKey:n,ctrlKey:o,metaKey:C.isDarwin()?i:o,altKey:s,spaceKey:this.keys[" "]};return this.pointer=d,this.activePointer=void 0,d}touchMove(e,t){let{shiftKey:n,ctrlKey:o,metaKey:i,altKey:s}=e,a=e.changedTouches[0],d=this.pointer,l=w.getPoint(a,this.bounds),c=d!=null&&d.point?oe.Vec.sub(l,d.point):[0,0],p=M(g({origin:l},d),{target:t,pointerId:a.identifier,point:l,delta:c,pressure:w.getPressure(a),shiftKey:n,ctrlKey:o,metaKey:C.isDarwin()?i:o,altKey:s,spaceKey:this.keys[" "]});return this.pointer=p,p}pointerDown(e,t){let{shiftKey:n,ctrlKey:o,metaKey:i,altKey:s}=e,a=w.getPoint(e,this.bounds);this.activePointer=e.pointerId;let d={target:t,pointerId:e.pointerId,origin:a,point:a,delta:[0,0],pressure:w.getPressure(e),shiftKey:n,ctrlKey:o,metaKey:C.isDarwin()?i:o,altKey:s,spaceKey:this.keys[" "]};return this.pointer=d,d}pointerEnter(e,t){let{shiftKey:n,ctrlKey:o,metaKey:i,altKey:s}=e,a=w.getPoint(e,this.bounds),d={target:t,pointerId:e.pointerId,origin:a,delta:[0,0],point:a,pressure:w.getPressure(e),shiftKey:n,ctrlKey:o,metaKey:C.isDarwin()?i:o,altKey:s,spaceKey:this.keys[" "]};return this.pointer=d,d}pointerMove(e,t){let{shiftKey:n,ctrlKey:o,metaKey:i,altKey:s}=e,a=this.pointer,d=w.getPoint(e,this.bounds),l=a!=null&&a.point?oe.Vec.sub(d,a.point):[0,0],c=M(g({origin:d},a),{target:t,pointerId:e.pointerId,point:d,delta:l,pressure:w.getPressure(e),shiftKey:n,ctrlKey:o,metaKey:C.isDarwin()?i:o,altKey:s,spaceKey:this.keys[" "]});return this.pointer=c,c}pointerUp(e,t){let{shiftKey:n,ctrlKey:o,metaKey:i,altKey:s}=e,a=this.pointer,d=w.getPoint(e,this.bounds),l=a!=null&&a.point?oe.Vec.sub(d,a.point):[0,0];this.activePointer=void 0;let c=M(g({origin:d},a),{target:t,pointerId:e.pointerId,point:d,delta:l,pressure:w.getPressure(e),shiftKey:n,ctrlKey:o,metaKey:C.isDarwin()?i:o,altKey:s,spaceKey:this.keys[" "]});return this.pointer=c,this.pointerUpTime=performance.now(),c}isDoubleClick(){if(!this.pointer)return!1;let{origin:e,point:t}=this.pointer,n=performance.now()-this.pointerUpTime<Ro&&oe.Vec.dist(e,t)<4;return n&&(this.activePointer=void 0),n}clear(){this.pointer=void 0}resetDoubleClick(){this.pointerUpTime=0}pinch(e,t){let{shiftKey:n,ctrlKey:o,metaKey:i,altKey:s}=this.keys,a=oe.Vec.sub(t,e),d={pointerId:0,target:"pinch",origin:t,delta:a,point:oe.Vec.sub(oe.Vec.toFixed(e),[this.bounds.minX,this.bounds.minY]),pressure:.5,shiftKey:n,ctrlKey:o,metaKey:C.isDarwin()?i:o,altKey:s,spaceKey:this.keys[" "]};return this.pointer=d,d}reset(){this.pointerUpTime=0,this.pointer=void 0,this.keyboard=void 0,this.activePointer=void 0,this.keys={}}static getPoint(e,t){return[+e.clientX.toFixed(2)-t.minX,+e.clientY.toFixed(2)-t.minY]}static getPressure(e){return"pressure"in e&&+e.pressure.toFixed(2)||.5}static commandKey(){return C.isDarwin()?"\u2318":"Ctrl"}},Eo=new w;var vn=require("react/jsx-runtime"),Bo=Object.freeze({});function Co(K){var k=K,{id:r="tl",shapeUtils:e,page:t,pageState:n,assets:o=Bo,users:i,userId:s,theme:a,meta:d,snapLines:l,eraseLine:c,grid:p,containerRef:m,performanceMode:u,components:v,hideHandles:T=!1,hideIndicators:b=!1,hideCloneHandles:x=!1,hideBindingHandles:f=!1,hideResizeHandles:y=!1,hideRotateHandles:Y=!1,hideBounds:U=!1,hideGrid:H=!0,showDashedBrush:P=!1,hideCursors:R}=k,S=N(k,["id","shapeUtils","page","pageState","assets","users","userId","theme","meta","snapLines","eraseLine","grid","containerRef","performanceMode","components","hideHandles","hideIndicators","hideCloneHandles","hideBindingHandles","hideResizeHandles","hideRotateHandles","hideBounds","hideGrid","showDashedBrush","hideCursors"]);ut(a,"#"+r);let $=z.useRef(null),ee=z.useRef(n);z.useEffect(()=>{ee.current=n},[n]);let[Pn,Rn]=z.useState(()=>({callbacks:S,shapeUtils:e,rSelectionBounds:$,rPageState:ee,bounds:{minX:0,minY:0,maxX:1/0,maxY:1/0,width:1/0,height:1/0},inputs:new w})),En=z.useCallback(Bn=>{Rn(Cn=>M(g({},Cn),{bounds:Bn}))},[]);return(0,vn.jsx)(me.Provider,{value:Pn,children:(0,vn.jsx)(yn,{id:r,page:t,pageState:n,assets:o,snapLines:l,eraseLine:c,grid:p,users:i,userId:s,externalContainerRef:m,hideBounds:U,hideIndicators:b,hideHandles:T,hideCloneHandles:x,hideBindingHandles:f,hideRotateHandle:Y,hideResizeHandles:y,hideGrid:H,showDashedBrush:P,onBoundsChange:En,performanceMode:u,components:v,meta:d,hideCursors:R})})}var So=z.memo(Co);var We=L(require("react"));var bn=require("react/jsx-runtime"),wo=We.memo(We.forwardRef(function(i,o){var s=i,{children:e,className:t=""}=s,n=N(s,["children","className"]);return(0,bn.jsx)("div",M(g({ref:o,className:`tl-positioned-div ${t}`,draggable:!1},n),{children:(0,bn.jsx)("div",{className:"tl-inner-div",children:e})}))}));var xn=require("@tldraw/intersect"),Ae=L(require("react"));var Pe=class{constructor(){B(this,"refMap",new Map);B(this,"boundsCache",new WeakMap);B(this,"showCloneHandles",!1);B(this,"hideBounds",!1);B(this,"isStateful",!1);B(this,"shouldRender",(e,t)=>!0);B(this,"getRef",e=>(this.refMap.has(e.id)||this.refMap.set(e.id,Ae.createRef()),this.refMap.get(e.id)));B(this,"hitTestBounds",(e,t)=>{let n=this.getBounds(e),o=I.getRotatedCorners(n,e.rotation);return o.every(i=>I.pointInBounds(i,t))||(0,xn.intersectPolygonBounds)(o,t).length>0});B(this,"getRotatedBounds",e=>I.getBoundsFromPoints(I.getRotatedCorners(this.getBounds(e),e.rotation)))}};B(Pe,"Component",e=>Ae.forwardRef(e)),B(Pe,"Indicator",e=>e);
/**
 * String.prototype.replaceAll() polyfill
 * https://gomakethings.com/how-to-replace-a-section-of-a-string-with-another-one-with-vanilla-js/
 * @author Chris Ferdinandi
 * @license MIT
 */
//# sourceMappingURL=index.js.map
